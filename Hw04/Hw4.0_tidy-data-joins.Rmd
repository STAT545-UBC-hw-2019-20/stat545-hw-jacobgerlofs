---
title: "STAT545 Assignment 4: Tidy Data and Joins"
output:
  html_document:
    toc: yes
    keep_md: yes
    theme: united
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, warning = FALSE, echo = FALSE}
suppressPackageStartupMessages(library(dplyr))
suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(gapminder))
suppressPackageStartupMessages(library(scales))
suppressPackageStartupMessages(library(tsibble))
```

# Part 1 - Univariate Option 1: Comparing Life Expectancies over Time

Full dataframe for reference...

```{r}
gapminder
```

## 1.1: Pivoting Wider to Comapre two Countries

```{r}
gapminder %>% 
  filter(country == "China" | country == "Taiwan") %>% 
  select(country, year, lifeExp) %>% 
  pivot_wider(id_cols = year,
              names_from = country,
              values_from = lifeExp)
```

## 1.2: Plotting with the New Data Layout

```{r}
gapminder %>% 
  filter(country == "China" | country == "Taiwan") %>% 
  select(country, year, lifeExp) %>% 
  pivot_wider(id_cols = year,
              names_from = country,
              values_from = lifeExp) %>% 
  ggplot(aes(Taiwan, China)) +
  geom_point(colour = "dark red") +
  theme_minimal()
```

## 1.3: Pivoting Longer to Return Original Organization
 
```{r}
gapminder %>% 
  filter(country == "China" | country == "Taiwan") %>% 
  select(country, year, lifeExp) %>% 
  pivot_wider(id_cols = year,
              names_from = country,
              values_from = lifeExp) %>% 
  pivot_longer(cols = c(China, Taiwan),
               names_to = "country",
               values_to = "lifeExp")
```

# Part 2 - Multivariate Option 1: Life Expectancy and GDP per Capita over Time

## 2.1: Pivoting Data to the New Layout

```{r}
gapminder %>% 
  filter(country == "China" | country == "Taiwan") %>% 
  select(country, year, lifeExp, gdpPercap) %>% 
  pivot_wider(id_cols = year,
              names_from = country,
              names_sep = "--",
              values_from = c(lifeExp, gdpPercap))
```

## 2.2: Pivoting Data Back to Original Format

```{r}
gapminder %>% 
  filter(country == "China" | country == "Taiwan") %>% 
  select(country, year, lifeExp, gdpPercap) %>% 
  pivot_wider(id_cols = year,
              names_from = country,
              names_sep = "--",
              values_from = c(lifeExp, gdpPercap)) %>% 
  pivot_longer(cols = -year,
               names_sep = "--",
               names_to = c(".value", "country"))
```

Note to self: the order arguments are entered into names_to is important - reversing the order gives funky results. I'm guessing this is due to "lifeExp" and "gdpPercap" (which are the values I'm retaining into columns) being the first component in the column header, and the countries being the second component.

# Part 3 - Table Joins

```{r}
guest <- read_csv("https://raw.githubusercontent.com/STAT545-UBC/Classroom/master/data/wedding/attend.csv")
email <- read_csv("https://raw.githubusercontent.com/STAT545-UBC/Classroom/master/data/wedding/emails.csv")
```


## 3.1 - Adding Email Addresses to the Guestlist

First, lets exmamine our data files to help with visualizing the code.

```{r}
guest
email
```

```{r}
email_longer <- email %>% 
  separate_rows(guest, sep = ", ") #convert the email list from groups of guests to individual guests
guest %>% 
  left_join(email_longer, c("name" = "guest"))
```

I had some trouble getting the join to reconcile groups of parties in the email list and the lis of names in the guest list. To fix this, I first re-arranged the email list into individual names and joined the names column with the new, longer, guests column.

