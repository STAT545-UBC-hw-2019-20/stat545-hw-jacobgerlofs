---
title: "STAT545 Assignment 3: Exploring Data with dplyr and ggplot pt. II"
output:
  html_document:
    toc: yes
    keep_md: yes
    theme: united
---

```{r, setup}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, warning = FALSE, echo = FALSE}
suppressPackageStartupMessages(library(dplyr))
suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(gapminder))
suppressPackageStartupMessages(library(scales))
```

# Task 1 - Low Life Expectancies within Continents over time: 

```{r}
gapminder
```


### Defining 'Low Life Expectancy'

#### To establish thresholds for low and high life expectancy, lets summarise life expectancies of the global population. LifeExp is related to year, therefore it may be misleading to ignore the year in obtaining these values to set our threshold. Using most recent year, for example, will yield the highest possible values. To compensate, we will examine life expactancy around the median year in the data set.

```{r}
median(gapminder$year)
```

```{r}
gapminder %>% 
  filter(year == "1982") %>% 
  summarise(mu = mean(lifeExp),
            sigma = sd(lifeExp)) 
```


#### Average life expactancy appears to be about 61.5 years in the year 1982. Low life expectancy can be defined as any life expectancy one standard deviation below the mean, representing the lower 32% of the population. As a absolute value, this is 50.7 years.

## 1.1 - Tibble: Number of Countries with Low Life Expectancy per Continent over Time

```{r}
gapminder %>% 
  mutate(smallLifeExp = lifeExp < 50.7) %>% 
  group_by(continent, year) %>% 
  tally(smallLifeExp)
```

## 1.2 - Plot: Number of Countries with Low Life Expectancy per Continent over Time

```{r}
gapminder %>% 
  mutate(smallLifeExp = lifeExp < 50.7) %>% 
  group_by(continent, year) %>% 
  tally(smallLifeExp) %>% 
  ggplot(aes(year, n, group = continent, colour = continent)) +
    geom_point() + 
    geom_line() +
    theme_minimal() +
    ylab("Number of Countries with Low Life Expectancies")
```


## 1.3 - Discussion: Declining Countries with Low Life Expectancies over Time

#### Looking at the plot, we can see that the number of countries within each continent with a "low life expectancy", as defined by average life expectancies below 50.7 years, decreases over time. This cannot be said for the Oceania region, as life expectancies are above 50.7 between 1952 and 2007. All countries within Europe and the Americas have a life expectancy above 50.7 by the 1980s, Asia only missing this statistic by a few countries. Africa continues to have coutries with low life expectancies, although the number of countries has been steadily declining.

------

# Task 2 - Min & Max GDP Per Capita for each Continent: 

## 2.1 - Tibble: Each Continent's Minimum and Maximum GDP Per Capita, irrelevent of time

```{r}
gapminder %>% 
  group_by(continent) %>% 
  summarise(max_gdp = max(gdpPercap),
            min_gdp = min(gdpPercap))
```

## 2.2 - Plot: Each Continent's Minimum and Maximum GDP Per Capita, irrelevent of time

### From the way the data is organized in 2.1, it seemed quite difficult to create a tacked bar graph - either that, or I didn't know how, despite research. In order to effectively create the stacked bar graph I wanted to make, I had to pivot the data first

```{r}
gapminder %>% 
  group_by(continent) %>% 
  summarise(max_gdp = max(gdpPercap),
            min_gdp = min(gdpPercap)) %>% 
  pivot_longer(cols = c(max_gdp, min_gdp),
               names_to = "min_or_max",
               values_to = "GDPPerCapita") %>% 
  ggplot(aes(x = continent, y = GDPPerCapita, fill = min_or_max)) +
  geom_bar(stat = "identity") +
  theme_minimal() +
  theme(legend.title = element_blank())+
  scale_fill_discrete(labels = c("Maximum GDP Value", "Minimum GDP Value")) +
  scale_y_continuous("GDP per capita", labels = scales::dollar_format())
```

### It's quite difficult to see the Min GDP values given the graph scale, so I've changed the scale into log base 10.

```{r}
gapminder %>% 
  group_by(continent) %>% 
  summarise(max_gdp = max(gdpPercap),
            min_gdp = min(gdpPercap)) %>% 
  pivot_longer(cols = c(max_gdp, min_gdp),
               names_to = "min_or_max",
               values_to = "GDPPerCapita") %>% 
  ggplot(aes(x = continent, y = GDPPerCapita, fill = min_or_max)) +
  geom_bar(stat = "identity") +
  theme_minimal() +
  theme(legend.title = element_blank())+
  scale_fill_discrete(labels = c("Maximum GDP Value", "Minimum GDP Value")) +
  scale_y_log10("GDP per capita", labels = scales::dollar_format())
```


#### Some details of this graph was rather finicky, among some common sites, I stumbled upon (Data Nova)[https://www.datanovia.com/en/], which was a helpful resource for some formatting details.

## X.3 - Discussion:

#### Given that the max and min continent gdp values were obtained from a singular country from any given year, and these details are not included in this analysis, the results are not particularily valuable. We see that each continent has a country with a very low min gdp, which was likely found around 1952 given the positive relationship between GDP and time. Each continent also has a country with quite a high max GDP as well. The spread in the data is therefore quite large, even making a regular-scale graphed difficult to read and comapare max to min GDPs.

------

# Task X - blah: 

## X.1 - Tibble: 

## X.2 - Plot:

## X.3 - Discussion:

------

